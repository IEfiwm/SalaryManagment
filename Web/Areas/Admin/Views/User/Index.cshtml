@inject IHtmlLocalizer<SharedResource> localizer
@inject Infrastructure.Repositories.IFileRepository _fileRepository;

@{
    ViewData["Title"] = localizer["Users"];
    ViewData["Caption"] = localizer["Manage Users here"];
    ViewBag.Title = "مدیریت کاربران";
}
<div class="card" id="myT">
    <div class="col-sm-12" style="padding:20px">
        @*        <a onclick="jQueryModalGet('/admin/user/OnGetCreate','Create User')" class="btn bg-success">
            <i class="fa fa-plus-square"></i> @localizer["Create"]
            </a>*@
        @*        <a id="reload" class="btn btn-primary text-white">
            <i class="fa fas fa-bolt"></i>
            @localizer["Reload"]
            </a>*@
    </div>
    <div id="viewAll" class="card-body table-responsive">
    </div>
</div>
<div class="modal" tabindex="-1" role="dialog" id="modal-user-docs">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header" style="direction:ltr!important;">
                <h5 class="modal-title">مدارک</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>
<div class="modal" tabindex="-1" role="dialog" id="modal-user-additional">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header" style="direction:ltr!important;">
                <h5 class="modal-title">تحت تکفل</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>

@section Scripts
{
<script src="~/js/site.js"></script>
<script>
    $(document).ready(function () {
        //$("#userTable").DataTable();
        loadData();
        $('#reload').on('click', function () {
            loadData();
        });
    });
    function loadData() {
        $('#viewAll').load('/admin/user/loadall');

        SetLoading(true,"#myT");
    }

    function GetDocuments(id)
    {
        $.ajax({
        url: "/admin/user/getdocuments?userId="+id,
        method: "GET",
        success: function (model) {

             $('#modal-user-docs .modal-body').html('<div class="row"></div>');
             $.each(model,function(index,item){
             var row=`<div class="col-md-3">
                        <select id="User_Doc_`+index+`" class="form-control ml-0 mr-0 valid" disabled>
                            <option value="1">عکس پرسنلی</option>
                            <option value="2">کارت ملی</option>
                            <option value="3">پشت کارت ملی</option>
                            <option value="4">صفحه اول شناسنامه</option>
                            <option value="5">صفحه دوم شناسنامه</option>
                            <option value="6">صفحه سوم شناسنامه</option>
                            <option value="7">کارت پایان خدمت</option>
                            <option value="8">آخرین مدرک تحصیلی</option>
                            <option value="9">تضامین 1</option>
                            <option value="10">تضامین 2</option>
                            <option value="11">سایر</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <a href="@_fileRepository.GetFileFullPath("").ImagePath\\`+item.fullPath+`" target="_blank">
                            <img class="form-control w-auto" src="@_fileRepository.GetFileFullPath("").ThumbPath\\`+item.fullPath+`" />
                        </a>
                    </div>` ;
                $('#modal-user-docs .modal-body .row').append(row);
                $('#User_Doc_'+index).val(item.documentType);

             });

             $('#modal-user-docs').modal('show')
        }
    });
    }
    function GetAdditionalUsers(id)
    {
        $.ajax({
        url: "/admin/user/GetAdditionalUsers?userId="+id,
        method: "GET",
        success: function (model) {

            $('#modal-user-additional .modal-body').html('<div class="row"></div>');
             $.each(model,function(index,item){
             var row=`
             <div class="col-md-4">
             <label class="form-label">رابطه خویشاوندی</label>
                <select class="form-control" id="User_additional_`+index+`" disabled>
                    <option value="1">همسر</option>
                    <option value="2">دختر</option>
                    <option value="3">پسر</option>
                    <option value="4">مادر</option>
                    <option value="5">پدر</option>
                </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">نام و نام خانوادگی</label>
                        <input  class="form-control" type="text"  value="`+item.firstName+` `+item.lastName+`" disabled>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">کد ملی</label>
                        <input  class="form-control" type="text"  value="`+item.nationalCode+`" disabled>
                    </div>`
                    ;
                $('#modal-user-additional .modal-body .row').append(row);
                $('#User_additional_'+index).val(item.familyRole);

             });

             $('#modal-user-additional').modal('show');
         }
    });
    }
</script>
}